# Image Cutter - 图像切割工具

图像切割工具，专门用于分割扫描的薄片图像，支持自动计算最佳分割数量。提供命令行版本、GUI版本和独立可执行文件三种使用方式。

## 目录

- [快速开始](#快速开始)
- [功能特性](#功能特性)
- [项目文件结构](#项目文件结构)
- [界面预览](#界面预览)
- [安装要求](#安装要求)
- [使用方法](#使用方法)
- [参数说明](#参数说明)
- [工作原理](#工作原理)
- [输出文件](#输出文件)
- [使用示例](#使用示例)
- [注意事项](#注意事项)
- [故障排除](#故障排除)
- [版本历史](#版本历史)
- [相关文档](#相关文档)
- [贡献指南](#贡献指南)
- [联系方式](#联系方式)

## 快速开始

### 方式1：独立可执行文件（推荐）

无需安装Python环境，双击即可使用：

- 双击运行 `启动图像切割器_GUI.bat`
- 或直接运行 `dist/ImageCutter_GUI.exe`

### 方式2：Python源码版本

需要Python 3.10环境：

- GUI版本：`python imageCutter_gui.py`
- 命令行版本：`python imageCutter.py`

## 功能特性

- **自动计算分割数**: 基于图像宽度自动计算最佳分割数（以6500像素为基准）
- **多线程处理**: 使用线程池提高处理速度
- **质量保持**: 保持原始图像质量，支持JPEG和PNG格式
- **智能检测**: 自动检测不一致的分割参数并记录日志
- **防覆盖**: 自动跳过已存在的分割文件
- **图形界面**: 直观易用的GUI界面，无需命令行操作
- **实时监控**: 进度条和状态显示，实时查看处理进度
- **详细日志**: 完整的操作日志，便于追踪和调试
- **独立可执行**: 无需Python环境的独立可执行文件（28MB）
- **一键启动**: 通过批处理脚本快速启动GUI程序
- **自动构建**: 提供自动构建脚本，可重新生成可执行文件

## 项目文件结构

```
ImageCutter/
├── dist/
│   └── ImageCutter_GUI.exe          # 独立可执行文件（28MB）
├── build/                           # 构建临时文件夹（自动生成）
├── __pycache__/                     # Python缓存文件夹（自动生成）
├── testImageData/                   # 测试图像数据
│   ├── 4423-1-01-05-XPL.jpg
│   ├── 4423-1-11-15-PPL.jpg
│   ├── 4423-2-091-095-XPL.jpg
│   ├── 4423-2-096-098-PPL.jpg
│   ├── 4423-2-096-098-XPL.jpg
│   └── 4423-2-99-100-XPL.jpg
├── 启动图像切割器_GUI.bat           # 快速启动脚本（推荐使用）
├── 构建图像切割器_GUI.bat           # 重新构建可执行文件脚本
├── 安装环境.bat                     # 自动安装Python环境和依赖
├── 测试项目.bat                     # 项目完整性测试脚本
├── 清理项目.bat                     # 清理临时文件和缓存脚本
├── 项目信息.bat                     # 查看项目详细信息
├── imageCutter_gui.py              # GUI版本源码（主程序）
├── imageCutter.py                  # 核心功能模块
├── imageCutter_gui_simple.spec     # PyInstaller配置文件
├── requirements.txt                # Python依赖包列表
├── config.py                       # 项目配置文件
├── .gitignore                      # Git版本控制忽略文件
└── README.md                       # 项目说明文档
```

### 主要文件说明

**核心程序文件:**

- `ImageCutter_GUI.exe`: 独立可执行程序，无需Python环境即可运行
- `imageCutter_gui.py`: GUI版本源代码，包含图形界面和多线程处理
- `imageCutter.py`: 核心功能模块，包含图像处理算法

**便民批处理脚本:**

- `启动图像切割器_GUI.bat`: 智能启动脚本（优先启动.exe，备选Python版本）
- `构建图像切割器_GUI.bat`: 自动构建独立可执行文件
- `安装环境.bat`: 一键安装Python依赖环境
- `测试项目.bat`: 全面测试项目完整性和功能
- `清理项目.bat`: 清理临时文件、缓存和测试数据
- `项目信息.bat`: 查看项目状态、版本和环境信息

**配置文件:**

- `requirements.txt`: 精确的Python依赖版本列表
- `config.py`: 项目配置和常量定义
- `.gitignore`: Git版本控制忽略规则
- `imageCutter_gui_simple.spec`: PyInstaller打包配置

## 界面预览

### GUI版本特色功能：

- **友好的用户界面**: 所有参数通过图形控件设置，无需记忆命令
- **文件夹浏览器**: 点击按钮即可选择目标文件夹
- **实时进度显示**: 进度条显示当前处理进度和完成百分比
- **详细处理日志**: 滚动文本区域显示详细的处理信息
- **一键停止功能**: 可随时停止正在进行的处理任务
- **智能参数验证**: 自动检查输入参数的有效性
- **多格式支持**: 下拉菜单选择支持的图像格式

## 安装要求

### 独立可执行版本（推荐）

- **系统要求**: Windows 10 或更高版本
- **内存要求**: 建议 4GB 或更多
- **磁盘空间**: 至少 100MB 可用空间
- **无需额外安装**: 不需要Python环境或任何依赖包

### Python源码版本

**Python版本**: 3.10
**依赖库**:

```bash
pip install tqdm==4.66.1 pillow==10.1.0 numpy==1.26.0
# tkinter 是 Python 内置模块，无需额外安装
```

## 使用方法

### 方式1：独立可执行文件（最简单）

**快速启动（推荐）：**

1. 双击运行 `启动图像切割器_GUI.bat`
2. 程序会自动检查文件并启动GUI界面

**直接运行：**

- 双击 `dist/ImageCutter_GUI.exe`

**功能特点：**

- 无需安装Python环境
- 一键启动，即开即用
- 完整的图形界面功能
- 自动错误检测和提示

### 方式2：Python GUI版本

**运行方式：**

```bash
python imageCutter_gui.py
```

**或使用批处理文件：**

```bash
# 双击运行
图像切割器_GUI版本.bat
```

### 方式3：命令行版本

**基本使用：**

```bash
python imageCutter.py --folder_path "D:\path\to\images" --num_splits 5 --auto_split
```

### GUI操作流程（适用于所有GUI版本）

1. **选择文件夹**: 点击"浏览"按钮选择包含图像的文件夹
2. **设置参数**:
   - 分割数量：使用微调框设置（建议保持自动计算）
   - 自动分割：勾选后自动使用计算的最佳分割数
   - 文件格式：下拉选择(.jpg, .png, .bmp等)
   - 排除字符串：设置要跳过的文件名模式
3. **开始处理**: 点击"开始处理"按钮
4. **监控进度**: 观察进度条和实时日志输出
5. **查看结果**: 处理完成后检查分割后的图像文件

### 重新构建可执行文件

如需重新构建可执行文件：

```bash
# 双击运行
构建图像切割器_GUI.bat
```

或手动构建：

```bash
pyinstaller imageCutter_gui_simple.spec
```

## 参数说明

| 参数              | 类型   | 必需 | 默认值      | 说明                 |
| ----------------- | ------ | ---- | ----------- | -------------------- |
| `--folder_path` | string | 是   | -           | 图像文件夹路径       |
| `--num_splits`  | int    | 是   | -           | 分割块数             |
| `--auto_split`  | flag   | 否   | False       | 自动使用计算的分割数 |
| `--suffix`      | string | 否   | ".jpg"      | 搜索的文件后缀名     |
| `--string`      | string | 否   | "_split_" | 排除的文件名字符串   |

## 工作原理

1. **文件扫描**: 递归搜索指定文件夹中的图像文件
2. **过滤处理**: 排除已分割的文件（包含 `_split_` 字符串的文件）
3. **分割计算**: 基于图像宽度计算最佳分割数（6500像素/块）
4. **一致性检查**: 比较设定分割数与计算分割数
5. **图像分割**: 按计算的宽度分割图像
6. **并行保存**: 使用线程池并行保存分割后的图像

## 输出文件

### 分割图像

- **命名格式**: `原文件名_split_编号.扩展名`
- **示例**: `sample.jpg` → `sample_split_1.jpg`, `sample_split_2.jpg`, ...

### 日志文件

- **文件名**: `inconsistent_files.log`
- **位置**: 当前工作目录
- **内容**: 分割数不一致的文件列表

## 使用示例

### 独立可执行版本使用流程：

1. **快速启动**:

   ```
   双击 → 启动图像切割器_GUI.bat
   ```
2. **选择文件夹**: 点击"浏览"选择图像文件夹
3. **配置参数**:

   - 勾选"自动使用计算的分割数"（推荐）
   - 选择文件格式：.jpg（默认）
   - 排除字符串：_split_（默认）
4. **开始处理**: 点击"开始处理"并观察进度
5. **查看结果**: 在原文件夹中查看 `文件名_split_1.jpg` 等分割文件

### 命令行版本示例：

#### 示例1：基本使用

```bash
python imageCutter.py --folder_path "D:\images" --num_splits 3
```

#### 示例2：自动分割

```bash
python imageCutter.py --folder_path "D:\images" --num_splits 3 --auto_split
```

#### 示例3：处理PNG文件

```bash
python imageCutter.py --folder_path "D:\images" --num_splits 3 --suffix ".png"
```

## 注意事项

1. **内存使用**: 程序会同时加载多个图像进行处理，请确保有足够内存
2. **磁盘空间**: 分割后的文件数量会成倍增加，请确保有足够的磁盘空间
3. **文件覆盖**: 程序不会覆盖已存在的分割文件，会自动跳过
4. **线程数量**: 程序会根据CPU核心数自动调整线程池大小
5. **图像格式**: 支持所有PIL可处理的图像格式，推荐使用JPEG和PNG

## 故障排除

### 独立可执行版本问题

**Q: 程序启动后没有界面显示？**
A:

1. 检查是否有杀毒软件阻止程序运行
2. 尝试以管理员身份运行 `启动图像切割器_GUI.bat`
3. 确保系统安装了最新的 Visual C++ 运行库

**Q: 提示"找不到可执行文件"？**
A:

1. 确认 `dist/ImageCutter_GUI.exe` 文件存在
2. 如果文件丢失，运行 `构建图像切割器_GUI.bat` 重新构建

**Q: 程序运行缓慢或崩溃？**
A:

1. 关闭其他占用内存的程序
2. 确保有至少4GB可用内存
3. 将图像文件移到本地硬盘（避免网络驱动器）

### 通用问题

**Q: 程序提示路径无效？**
A: 检查文件夹路径是否正确，使用双引号包围包含空格的路径。

**Q: 分割后的图像质量下降？**
A: 程序默认使用高质量设置（JPEG质量95%），如需调整可修改源码中的 `save_params`。

**Q: 处理速度慢？**
A: 程序已使用多线程优化，速度取决于CPU核心数和磁盘I/O性能。

**Q: 内存不足？**
A: 对于特大图像，可能需要调整 `Image.MAX_IMAGE_PIXELS` 限制或增加系统内存。

## 版本历史

### v1.2.0 - 独立可执行GUI版本 (2025年8月29日)

- **全新特性**:
  - 新增独立可执行文件 `ImageCutter_GUI.exe` (28MB)
  - 无需Python环境，一键启动使用
  - 快速启动脚本 `启动图像切割器_GUI.bat`
  - 自动构建脚本 `构建图像切割器_GUI.bat`
  - 完整的README文档和使用说明
- **性能优化**:
  - 优化依赖包，减小文件体积
  - 改进启动速度和内存使用
  - 增强错误处理和用户提示
- **技术升级**:
  - 基于 PyInstaller 6.11.1 构建
  - Python 3.10.11 和 Conda 环境
  - 优化的 .spec 配置文件

### v1.2.0 - GUI版本 (2025年8月29日)

- **新增功能**:
  - 直观的图形用户界面
  - 实时进度监控和日志显示
  - 文件夹浏览器和参数验证
  - 多线程处理和停止功能
  - 完全兼容原有命令行功能

### CLI v1.0.1 - 命令行优化版本(2024年12月11日)

- 修复无法保存日志文件的问题
- 增强异常处理机制
- 改进资源管理和变量作用域
- 添加参数验证

### CLI v1.0.0 - 初始版本(2024年12月10日)

- 基本图像分割功能
- 自动计算最佳分割数
- 多线程处理支持

## 相关文档

- **[imageCutter_gui_simple.spec](./imageCutter_gui_simple.spec)** - PyInstaller构建配置
- **[requirements.txt](./requirements.txt)** - Python依赖包列表
- **[inconsistent_files.log](./inconsistent_files.log)** - 处理过程中的日志文件

## 贡献指南

欢迎提交 Issue 和 Pull Request！

### 开发环境设置

```bash
# 克隆项目
git clone https://github.com/Kai-FnLock/GMAS_Scripts.git
cd GMAS_Scripts/ImageCutter

# 安装依赖
pip install -r requirements.txt

# 运行GUI版本
python imageCutter_gui.py
```

### 构建可执行文件

```bash
# 使用批处理脚本
构建图像切割器_GUI.bat

# 或手动构建
pyinstaller imageCutter_gui_simple.spec
```

## 许可证

**Full Copyright** - 保留所有权利

## 联系方式

- **作者**: Kai Cao
- **邮箱**: caokai_cgs@163.com
- **项目**: [GMAS_Scripts/ImageCutter](https://github.com/Kai-FnLock/GMAS_Scripts)

---

如果这个项目对您有帮助，请给它一个星标！
